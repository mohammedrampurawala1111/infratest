name: Lightweight Tests

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    # Run nightly at 2 AM UTC
    - cron: '0 2 * * *'

jobs:
  # Test core functionality without LocalStack
  core-tests:
    name: Core Functionality Tests
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
          cache-dependencies: true
      
      - name: Install Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: '1.6.0'
          terraform_wrapper: false
      
      - name: Build and test
        run: |
          go build -o infratest .
          chmod +x infratest
          
          # Test CLI help
          ./infratest --help
          
          # Test YAML parsing (should fail gracefully without terraform)
          ./infratest run examples/simple-vpc/flow.yaml 2>&1 | head -20 || true
          
          # Run unit tests
          go test ./... -v -short

